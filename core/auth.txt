The Beginner’s Guide to Authentication in Code of Clan

Introduction

User authentication often appears complex due to terms such as OAuth, JWT, callbacks, and token refresh flows. This document explains how authentication works in the Code of Clan project in a clear, structured, and practical manner.

The objective is to explain what happens, why it happens, and where the logic exists in the codebase.

---

Conceptual Overview

The authentication system involves four primary actors:

1. User
   The individual attempting to log in.

2. Frontend Application
   Initiates login requests and stores authentication state.

3. Backend API
   Verifies identity, manages users, and issues tokens.

4. OAuth Providers (GitHub, Google, Discord)
   External services responsible for validating user identity.

Once authentication is successful, the backend issues a JWT (JSON Web Token). This token acts as cryptographic proof that the user has already been authenticated.

---

Authentication Flow (OAuth Login)

This section describes the complete flow when a user selects “Login with GitHub”.

Step 1: Login Request

User Action
The user clicks the “Login with GitHub” button in the frontend.

System Behavior

* The frontend requests an OAuth authorization URL from the backend.
* The backend generates the correct GitHub OAuth URL.
* The frontend redirects the user to GitHub.

Code Location
backend/auth/views/oauth.py
GitHubAuthURLView

---

Step 2: User Verification by OAuth Provider

User Action
The user logs into GitHub and grants permission to Code of Clan.

System Behavior

* GitHub authenticates the user directly.
* On success, GitHub redirects the user back to the frontend.
* The redirect includes a temporary authorization code.

Example Callback URL
[http://localhost:5173/auth/callback?code=abc123secret](http://localhost:5173/auth/callback?code=abc123secret)

At this stage, only GitHub has authenticated the user. Code of Clan has not yet verified anything.

---

Step 3: Code Exchange and Verification

User Action
The frontend extracts the authorization code from the callback URL.

System Behavior

* The frontend sends the code to the backend.
* The backend sends the code to GitHub’s token endpoint.
* GitHub validates the code and returns user information such as email and profile data.

This step confirms that:

* The authorization code is valid.
* The user genuinely authenticated via GitHub.

Code Location
backend/auth/services.py
handle_oauth_login

---

Step 4: User Creation and Token Issuance

Once verified user data is received:

* The backend checks the database.
* If the user does not exist, a new user record is created.
* If the user already exists, profile data is updated if required.
* The backend generates two JWTs:

  * Access Token
  * Refresh Token

These tokens are returned to the frontend.

Code Location
backend/auth/utils.py
generate_tokens

---

JSON Web Tokens (JWT)

A JWT is a cryptographically signed string used to prove authentication.

Frontend Responsibilities

* Store the access token (commonly in local storage).
* Attach the access token to every authenticated API request.

Backend Responsibilities

* Verify the token signature on each request.
* Validate expiration and integrity.
* Avoid repeated database lookups for authentication.

Code Location
backend/auth/authentication.py

---

Why Two Tokens Are Used

Access Token

* Short lifespan (typically 5 minutes).
* Used for every authenticated API request.
* Limits exposure if compromised.

Refresh Token

* Longer lifespan (typically 7 days).
* Used only to obtain a new access token.
* Sent infrequently.
* Enables persistent login without re-authentication.

When the access token expires, the frontend calls:
POST /api/auth/refresh/

---

Project Structure Overview

auth/views.py
Defines authentication-related API endpoints.

auth/services.py
Contains core authentication logic and OAuth provider communication.

auth/utils.py
Utility functions for token creation and external requests.

auth/authentication.py
Validates tokens for protected API routes.

store/useAuthStore.js
Frontend state management for authentication.

---

Summary

* OAuth providers authenticate users externally.
* The backend verifies OAuth responses.
* JWTs are issued after successful verification.
* Access tokens secure API calls.
* Refresh tokens maintain long-lived sessions.

This design ensures security, scalability, and clean separation of concerns.

---

If you want next-level polish, I can:

* Convert this into internal engineering documentation
* Add a request/response flow section
* Include security considerations and failure cases
* Rewrite it for absolute beginners or auditors

Say what you want optimized.
